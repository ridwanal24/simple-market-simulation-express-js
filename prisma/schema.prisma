// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int             @id @default(autoincrement())
  username           String          @unique
  email              String?         @unique
  password           String?
  balance            Int             @default(0)
  user_items         UserItem[]
  market_requests    MarketRequest[]
  created_at         DateTime?       @default(now())
  buyerTransactions  Transaction[]   @relation("buyerTransactions")
  sellerTransactions Transaction[]   @relation("sellerTransactions")
}

model Item {
  id              Int             @id @default(autoincrement())
  name            String
  description     String?
  user_items      UserItem[]
  market_requests MarketRequest[]
  created_at      DateTime        @default(now())
  transaction     Transaction[]
}

model UserItem {
  id             Int             @id @default(autoincrement())
  user_id        Int?
  item_id        Int?
  quantity       Int
  user           User?           @relation(fields: [user_id], references: [id])
  item           Item?           @relation(fields: [item_id], references: [id])
  market_listing MarketListing[]
}

model MarketListing {
  id           Int       @id @default(autoincrement())
  user_item_id Int?
  user_item    UserItem? @relation(fields: [user_item_id], references: [id])
  quantity     Int
  price        Int
  created_at   DateTime  @default(now())
}

model MarketRequest {
  id         Int      @id @default(autoincrement())
  buyer_id   Int
  item_id    Int
  buyer      User     @relation(fields: [buyer_id], references: [id])
  item       Item     @relation(fields: [item_id], references: [id])
  price      Int
  quantity   Int
  created_at DateTime @default(now())
}

model Transaction {
  id        Int      @id @default(autoincrement())
  buyer_id  Int?
  seller_id Int?
  item_id   Int?
  buyer     User?    @relation("buyerTransactions", fields: [buyer_id], references: [id])
  seller    User?    @relation("sellerTransactions", fields: [seller_id], references: [id])
  item      Item?    @relation(fields: [item_id], references: [id])
  price     Int
  quantity  Int
  timestamp DateTime @default(now())
}
